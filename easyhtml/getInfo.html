<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>è®¾å¤‡ä¿¡æ¯è·å–å·¥å…·</title>
  
  <style>
    /* æ–°å¢æ ·å¼ */
    .clipboard-input {
      width: 100%;
      padding: 12px;
      border: 1px solid #e2e8f0;
      border-radius: 8px;
      margin-bottom: 16px;
      min-height: 100px;
      font-family: inherit;
      resize: vertical;
    }
    
    .dark-mode .clipboard-input {
      background-color: #1e293b;
      border-color: #475569;
      color: #e2e8f0;
    }
    
    .recording-indicator {
      display: inline-block;
      width: 12px;
      height: 12px;
      border-radius: 50%;
      background-color: #EF4444;
      margin-right: 6px;
      animation: pulse 1.5s infinite;
    }
    
    .recordings-list {
      margin-top: 16px;
      border-top: 1px solid #e2e8f0;
      padding-top: 16px;
    }
    
    .recording-item {
      margin-bottom: 16px;
      padding: 12px;
      border-radius: 8px;
      background-color: #f8fafc;
    }
    
    .dark-mode .recording-item {
      background-color: #334155;
    }
    
    .recording-info {
      display: flex;
      justify-content: space-between;
      margin-bottom: 8px;
      font-size: 0.875rem;
    }
    
    /* åŸæœ‰æ ·å¼ */
    .file-upload-container {
      margin-bottom: 16px;
    }
    
    .file-input {
      display: none;
    }
    
    .file-label {
      display: inline-block;
      padding: 10px 16px;
      background-color: #e2e8f0;
      color: #1e293b;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.2s ease;
      margin-bottom: 12px;
    }
    
    .file-label:hover {
      background-color: #cbd5e1;
    }
    
    .file-info {
      font-size: 0.9rem;
      color: #64748b;
      margin-bottom: 8px;
    }
    
    .file-content {
      border: 1px solid #e2e8f0;
      border-radius: 8px;
      padding: 12px;
      max-height: 200px;
      overflow-y: auto;
      background-color: #f8fafc;
      font-family: monospace;
      font-size: 0.9rem;
    }
    
    .dark-mode .file-label {
      background-color: #475569;
      color: #e2e8f0;
    }
    
    .dark-mode .file-content {
      background-color: #1e293b;
      border-color: #475569;
      color: #e2e8f0;
    }
    
    /* åŸºç¡€æ ·å¼ */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Open Sans", "Helvetica Neue", sans-serif;
    }
    
    body {
      background-color: #f9fafb;
      color: #1e293b;
      min-height: 100vh;
      line-height: 1.5;
    }
    
    /* å¸ƒå±€ç»„ä»¶ */
    .container {
      width: 100%;
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 16px;
    }
    
    header {
      background-color: #4F46E5;
      color: white;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      position: sticky;
      top: 0;
      z-index: 50;
    }
    
    .header-content {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 16px;
    }
    
    .header-title {
      font-size: clamp(1.2rem, 5vw, 1.8rem);
      font-weight: bold;
    }
    
    main {
      padding: 24px 0;
    }
    
    footer {
      background-color: #1e293b;
      color: white;
      padding: 24px 0;
      margin-top: 40px;
      text-align: center;
    }
    
    /* å¡ç‰‡æ ·å¼ */
    .card-container {
      display: grid;
      grid-template-columns: 1fr;
      gap: 24px;
    }
    
    @media (min-width: 768px) {
      .card-container {
        grid-template-columns: repeat(2, 1fr);
      }
    }
    
    .card {
      background-color: white;
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
      animation: fadeIn 0.5s ease-in-out;
    }
    
    .card-full {
      grid-column: 1 / -1;
    }
    
    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
    }
    
    .card-title {
      font-size: 1.25rem;
      font-weight: bold;
      display: flex;
      align-items: center;
    }
    
    .card-icon {
      margin-right: 8px;
      font-size: 1.5rem;
    }
    
    .status-badge {
      font-size: 0.875rem;
      padding: 4px 10px;
      border-radius: 999px;
      background-color: #f1f5f9;
    }
    
    .card-content {
      margin-bottom: 20px;
      min-height: 80px;
      color: #64748b;
    }
    
    /* è¯­éŸ³è¯†åˆ«ç»“æœæ ·å¼ */
    .transcriptBox {
      border: 1px solid #e2e8f0;
      border-radius: 8px;
      padding: 12px;
      min-height: 80px;
      margin-bottom: 16px;
      background-color: #f8fafc;
      color: #334155;
    }
    
    /* æŒ‰é’®æ ·å¼ */
    .btn {
      padding: 12px;
      border-radius: 8px;
      border: none;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 8px;
    }
    
    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 12px rgba(79, 70, 229, 0.2);
    }
    
    .btn-primary {
      background-color: #4F46E5;
      color: white;
    }
    
    .btn-primary:hover {
      background-color: #4338ca;
    }
    
    .btn-danger {
      background-color: #EF4444;
      color: white;
    }
    
    .btn-danger:hover {
      background-color: #dc2626;
    }
    
    .btn-disabled {
      background-color: #94a3b8;
      color: white;
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }
    
    .btn-group {
      display: flex;
      gap: 12px;
    }
    
    .btn-group .btn {
      flex: 1;
    }
    
    /* çŠ¶æ€æç¤º */
    .status-box {
      padding: 16px;
      border-radius: 8px;
      margin-bottom: 24px;
      display: none;
      animation: fadeIn 0.5s ease-in-out;
    }
    
    .status-success {
      background-color: #dcfce7;
      color: #166534;
    }
    
    .status-error {
      background-color: #fee2e2;
      color: #b91c1c;
    }
    
    /* æ‘„åƒå¤´é¢„è§ˆ */
    .camera-preview {
      width: 100%;
      height: 160px;
      object-fit: cover;
      border-radius: 8px;
      background-color: #f1f5f9;
      margin-bottom: 20px;
    }
    
    /* å½•åˆ¶è§†é¢‘é¢„è§ˆ */
    .recorded-video {
      width: 100%;
      border-radius: 8px;
      margin-bottom: 8px;
    }
    
    /* åŠ¨ç”» */
    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    @keyframes pulse {
      0%, 100% {
        opacity: 1;
      }
      50% {
        opacity: 0.5;
      }
    }
    
    .pulse {
      animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
    }
    
    /* æ·±è‰²æ¨¡å¼ */
    .dark-mode {
      background-color: #1e293b;
      color: white;
    }
    
    .dark-mode .card {
      background-color: #334155;
    }
    
    .dark-mode .card-content {
      color: #cbd5e1;
    }
    
    .dark-mode .status-badge {
      background-color: #475569;
    }
    
    .dark-mode .transcriptBox {
      background-color: #1e293b;
      border-color: #475569;
      color: #e2e8f0;
    }
    
    .theme-toggle {
      background: none;
      border: none;
      color: white;
      font-size: 1.25rem;
      cursor: pointer;
      padding: 8px;
      border-radius: 50%;
    }
    
    .theme-toggle:hover {
      background-color: rgba(255, 255, 255, 0.1);
    }
  </style>
</head>
<body>
  <!-- é¡¶éƒ¨å¯¼èˆª -->
  <header>
    <div class="container header-content">
      <h1 class="header-title">
        <span class="card-icon">ğŸ“±</span>è®¾å¤‡ä¿¡æ¯å·¥å…·
      </h1>
      <button id="themeToggle" class="theme-toggle">ğŸŒ™</button>
    </div>
  </header>

  <!-- ä¸»å†…å®¹åŒº -->
  <main class="container">
    <!-- çŠ¶æ€æç¤ºæ¡† -->
    <div id="statusBox" class="status-box"></div>
    
    <!-- åŠŸèƒ½å¡ç‰‡å®¹å™¨ï¼ˆæŒ‰æ–°é¡ºåºæ’åˆ—ï¼‰ -->
    <div class="card-container">
      <!-- 1. åœ°ç†ä½ç½®å¡ç‰‡ -->
      <div class="card">
        <div class="card-header">
          <h2 class="card-title">
            <span class="card-icon">ğŸ“</span>åœ°ç†ä½ç½®
          </h2>
          <span id="locationStatus" class="status-badge">æœªè·å–</span>
        </div>
        <div id="locationInfo" class="card-content">
          ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®è·å–ç»çº¬åº¦ä¿¡æ¯
        </div>
        <button id="getLocation" class="btn btn-primary">
          <span>ğŸ§­</span>è·å–ç»çº¬åº¦
        </button>
      </div>
      
      <!-- 2. æ‘„åƒå¤´å¡ç‰‡ -->
      <div class="card">
        <div class="card-header">
          <h2 class="card-title">
            <span class="card-icon">ğŸ“¹</span>æ‘„åƒå¤´
          </h2>
          <span id="cameraStatus" class="status-badge">æœªå¼€å¯</span>
        </div>
        <div>
          <video id="cameraPreview" class="camera-preview" autoplay playsinline></video>
          <!-- å½•åˆ¶çŠ¶æ€æŒ‡ç¤ºå™¨ -->
          <div id="recordingIndicator" style="display: none; margin-bottom: 12px; color: #EF4444; font-size: 0.9rem;">
            <span class="recording-indicator"></span>æ­£åœ¨å½•åˆ¶...
          </div>
        </div>
        <div class="btn-group">
          <button id="startCamera" class="btn btn-primary">
            <span>â–¶ï¸</span>å¼€å¯
          </button>
          <button id="stopCamera" class="btn btn-disabled" disabled>
            <span>â¹ï¸</span>å…³é—­
          </button>
        </div>
        <!-- å½•åˆ¶æ§åˆ¶æŒ‰é’® -->
        <div class="btn-group" style="margin-top: 12px;">
          <button id="startRecordingVideo" class="btn btn-danger" disabled>
            <span>âºï¸</span>å¼€å§‹å½•åˆ¶
          </button>
          <button id="stopRecordingVideo" class="btn btn-disabled" disabled>
            <span>â¹ï¸</span>åœæ­¢å½•åˆ¶
          </button>
        </div>
        <!-- å½•åˆ¶è§†é¢‘åˆ—è¡¨ -->
        <div class="recordings-list" id="recordingsList">
          <!-- å½•åˆ¶çš„è§†é¢‘å°†åŠ¨æ€æ·»åŠ åˆ°è¿™é‡Œ -->
        </div>
      </div>
      
      <!-- 3. å½•éŸ³ä¸è¯­éŸ³è½¬æ–‡å­—å¡ç‰‡ -->
      <div class="card">
        <div class="card-header">
          <h2 class="card-title">
            <span class="card-icon">ğŸ¤</span>å½•éŸ³ä¸è¯­éŸ³è½¬æ–‡å­—
          </h2>
          <span id="audioStatus" class="status-badge">æœªå½•éŸ³</span>
        </div>
        <div class="transcriptBox" id="transcriptBox">
          è¯­éŸ³è¯†åˆ«ç»“æœå°†æ˜¾ç¤ºåœ¨è¿™é‡Œ...
        </div>
        <div id="audioInfo" class="card-content">
          ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®å¼€å§‹å½•éŸ³å¹¶å®æ—¶è½¬æ–‡å­—
        </div>
        <div class="btn-group">
          <button id="startRecording" class="btn btn-primary">
            <span>â–¶ï¸</span>å¼€å§‹
          </button>
          <button id="stopRecording" class="btn btn-disabled" disabled>
            <span>â¹ï¸</span>åœæ­¢
          </button>
        </div>
      </div>
      
      <!-- 4. å‰ªè´´æ¿è¯»å–å¡ç‰‡ -->
      <div class="card">
        <div class="card-header">
          <h2 class="card-title">
            <span class="card-icon">ğŸ“‹</span>å‰ªè´´æ¿è¯»å–
          </h2>
          <span id="clipboardReadStatus" class="status-badge">æœªè·å–</span>
        </div>
        <div id="clipboardReadInfo" class="card-content">
          ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®è·å–å‰ªè´´æ¿å†…å®¹
        </div>
        <button id="getClipboard" class="btn btn-primary">
          <span>ğŸ“¥</span>è¯»å–å‰ªè´´æ¿
        </button>
      </div>
      
      <!-- 5. å‰ªè´´æ¿å†™å…¥å¡ç‰‡ï¼ˆæ–°å¢ï¼‰ -->
      <div class="card">
        <div class="card-header">
          <h2 class="card-title">
            <span class="card-icon">ğŸ“‹</span>å‰ªè´´æ¿å†™å…¥
          </h2>
          <span id="clipboardWriteStatus" class="status-badge">æœªå†™å…¥</span>
        </div>
        <div class="card-content">
          <textarea id="clipboardWriteInput" class="clipboard-input" placeholder="è¯·è¾“å…¥è¦å†™å…¥å‰ªè´´æ¿çš„å†…å®¹..."></textarea>
        </div>
        <button id="setClipboard" class="btn btn-primary">
          <span>ğŸ“¤</span>å†™å…¥å‰ªè´´æ¿
        </button>
      </div>
      
      <!-- 6. é™€èºä»ªå¡ç‰‡ -->
      <div class="card">
        <div class="card-header">
          <h2 class="card-title">
            <span class="card-icon">ğŸ”„</span>é™€èºä»ª
          </h2>
          <span id="gyroStatus" class="status-badge">æœªå¼€å¯</span>
        </div>
        <div id="gyroInfo" class="card-content">
          ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®è·å–é™€èºä»ªä¿¡æ¯
        </div>
        <div class="btn-group">
          <button id="startGyro" class="btn btn-primary">
            <span>â–¶ï¸</span>å¼€å¯ç›‘æµ‹
          </button>
          <button id="stopGyro" class="btn btn-disabled" disabled>
            <span>â¹ï¸</span>åœæ­¢ç›‘æµ‹
          </button>
        </div>
      </div>
      
      <!-- 7. IPä¿¡æ¯å¡ç‰‡ -->
      <div class="card card-full">
        <div class="card-header">
          <h2 class="card-title">
            <span class="card-icon">ğŸŒ</span>IPä¿¡æ¯
          </h2>
          <span id="ipStatus" class="status-badge">æœªè·å–</span>
        </div>
        <div id="ipInfo" class="card-content">
          ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®è·å–IPä¿¡æ¯
        </div>
        <button id="getIpInfo" class="btn btn-primary">
          <span>ğŸ”</span>è·å–IPä¿¡æ¯
        </button>
      </div>
      
      <!-- 8. è®¾å¤‡ä¿¡æ¯å¡ç‰‡ -->
      <div class="card card-full">
        <div class="card-header">
          <h2 class="card-title">
            <span class="card-icon">â„¹ï¸</span>è®¾å¤‡ä¿¡æ¯
          </h2>
          <span id="deviceStatus" class="status-badge">æœªè·å–</span>
        </div>
        <div id="deviceInfo" class="card-content">
          ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®è·å–è®¾å¤‡ä¿¡æ¯
        </div>
        <button id="getDeviceInfo" class="btn btn-primary">
          <span>ğŸ“±</span>è·å–ä¿¡æ¯
        </button>
      </div>
    </div>
  </main>

  <!-- é¡µè„š -->
  <footer>
    <div class="container">
      <p style="font-size: 1.1rem; font-weight: 500;">è®¾å¤‡ä¿¡æ¯è·å–å·¥å…·</p>
      <p style="color: #94a3b8; font-size: 0.875rem; margin-top: 8px;">æ‰€æœ‰ä¿¡æ¯ä»…åœ¨æœ¬åœ°å¤„ç†ï¼Œä¸ä¼šä¸Šä¼ åˆ°æœåŠ¡å™¨</p>
    </div>
  </footer>

  <script>
    // å…¨å±€å˜é‡
    let mediaRecorder = null;
    let audioChunks = [];
    let cameraStream = null;
    let videoRecorder = null; // è§†é¢‘å½•åˆ¶å™¨
    let videoChunks = []; // è§†é¢‘æ•°æ®å—
    let recordingStartTime = null; // å½•åˆ¶å¼€å§‹æ—¶é—´
    let gyroHandler = null;
    let speechRecognition = null;
    let isRecognitionSupported = false;
    
    // DOMå…ƒç´ è·å–ï¼ˆæ–°å¢å‰ªè´´æ¿å†™å…¥ç›¸å…³ï¼‰
    const setClipboardBtn = document.getElementById('setClipboard');
    const clipboardWriteInput = document.getElementById('clipboardWriteInput');
    const clipboardWriteStatus = document.getElementById('clipboardWriteStatus');
    const clipboardReadInfo = document.getElementById('clipboardReadInfo');
    const clipboardReadStatus = document.getElementById('clipboardReadStatus');
    
    // è§†é¢‘å½•åˆ¶ç›¸å…³å…ƒç´ 
    const startRecordingVideoBtn = document.getElementById('startRecordingVideo');
    const stopRecordingVideoBtn = document.getElementById('stopRecordingVideo');
    const recordingIndicator = document.getElementById('recordingIndicator');
    const recordingsList = document.getElementById('recordingsList');
    
    // å…¶ä»–DOMå…ƒç´ 
    const statusBox = document.getElementById('statusBox');
    const getLocationBtn = document.getElementById('getLocation');
    const locationInfo = document.getElementById('locationInfo');
    const locationStatus = document.getElementById('locationStatus');
    const startCameraBtn = document.getElementById('startCamera');
    const stopCameraBtn = document.getElementById('stopCamera');
    const cameraPreview = document.getElementById('cameraPreview');
    const cameraStatus = document.getElementById('cameraStatus');
    const startAudioRecordingBtn = document.getElementById('startRecording');
    const stopAudioRecordingBtn = document.getElementById('stopRecording');
    const audioInfo = document.getElementById('audioInfo');
    const audioStatus = document.getElementById('audioStatus');
    const transcriptBox = document.getElementById('transcriptBox');
    const getClipboardBtn = document.getElementById('getClipboard');
    const startGyroBtn = document.getElementById('startGyro');
    const stopGyroBtn = document.getElementById('stopGyro');
    const gyroInfo = document.getElementById('gyroInfo');
    const gyroStatus = document.getElementById('gyroStatus');
    const getDeviceInfoBtn = document.getElementById('getDeviceInfo');
    const deviceInfo = document.getElementById('deviceInfo');
    const deviceStatus = document.getElementById('deviceStatus');
    const getIpInfoBtn = document.getElementById('getIpInfo');
    const ipInfo = document.getElementById('ipInfo');
    const ipStatus = document.getElementById('ipStatus');
    
    // å‰ªè´´æ¿å†™å…¥åŠŸèƒ½ï¼ˆæ–°å¢ï¼‰
    setClipboardBtn.addEventListener('click', async () => {
      try {
        if (!navigator.clipboard) {
          throw new Error('æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒå‰ªè´´æ¿API');
        }
        
        const text = clipboardWriteInput.value.trim();
        if (!text) {
          showStatus('è¯·è¾“å…¥è¦å†™å…¥å‰ªè´´æ¿çš„å†…å®¹', true);
          return;
        }
        
        await navigator.clipboard.writeText(text);
        updateStatus(clipboardWriteStatus, 'å·²å†™å…¥');
        showStatus('å†…å®¹å·²æˆåŠŸå†™å…¥å‰ªè´´æ¿');
      } catch (error) {
        const errorMsg = `å‰ªè´´æ¿å†™å…¥å¤±è´¥: ${error.message}`;
        showStatus(errorMsg, true);
        updateStatus(clipboardWriteStatus, 'å†™å…¥å¤±è´¥', false);
      }
    });
    
    // å‰ªè´´æ¿è¯»å–åŠŸèƒ½ï¼ˆè°ƒæ•´IDå¯¹åº”ï¼‰
    getClipboardBtn.addEventListener('click', async () => {
      try {
        if (!navigator.clipboard) {
          throw new Error('æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒå‰ªè´´æ¿API');
        }
        
        clipboardReadInfo.textContent = 'æ­£åœ¨è·å–å‰ªè´´æ¿å†…å®¹...';
        const text = await navigator.clipboard.readText();
        
        if (text.trim() === '') {
          clipboardReadInfo.textContent = 'å‰ªè´´æ¿ä¸ºç©º';
        } else {
          clipboardReadInfo.textContent = text;
        }
        
        updateStatus(clipboardReadStatus, 'å·²è·å–');
        showStatus('å‰ªè´´æ¿å†…å®¹è·å–æˆåŠŸ');
      } catch (error) {
        const errorMsg = `å‰ªè´´æ¿è·å–å¤±è´¥: ${error.message}`;
        clipboardReadInfo.textContent = errorMsg;
        showStatus(errorMsg, true);
        updateStatus(clipboardReadStatus, 'è·å–å¤±è´¥', false);
      }
    });
    
    // åˆå§‹åŒ–è¯­éŸ³è¯†åˆ«
    function initSpeechRecognition() {
      try {
        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        if (SpeechRecognition) {
          speechRecognition = new SpeechRecognition();
          speechRecognition.lang = 'zh-CN';
          speechRecognition.continuous = true;
          speechRecognition.interimResults = true;
          isRecognitionSupported = true;
          
          speechRecognition.onresult = (event) => {
            let transcript = '';
            for (let i = 0; i < event.results.length; i++) {
              transcript += event.results[i][0].transcript;
            }
            transcriptBox.textContent = transcript;
          };
          
          speechRecognition.onerror = (event) => {
            console.error('è¯­éŸ³è¯†åˆ«é”™è¯¯:', event.error);
            if (event.error === 'not-allowed') {
              showStatus('è¯­éŸ³è¯†åˆ«éœ€è¦éº¦å…‹é£æƒé™', true);
            } else {
              showStatus(`è¯­éŸ³è¯†åˆ«é”™è¯¯: ${event.error}`, true);
            }
          };
          
          speechRecognition.onend = () => {
            if (mediaRecorder && mediaRecorder.state !== 'inactive') {
              speechRecognition.start();
            }
          };
        } else {
          isRecognitionSupported = false;
          transcriptBox.textContent = 'æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒè¯­éŸ³è¯†åˆ«åŠŸèƒ½';
        }
      } catch (error) {
        isRecognitionSupported = false;
        console.error('åˆå§‹åŒ–è¯­éŸ³è¯†åˆ«å¤±è´¥:', error);
        transcriptBox.textContent = 'è¯­éŸ³è¯†åˆ«åˆå§‹åŒ–å¤±è´¥';
      }
    }
    
    // æ˜¾ç¤ºçŠ¶æ€æ¶ˆæ¯
    function showStatus(message, isError = false) {
      statusBox.textContent = message;
      statusBox.classList.remove('status-success', 'status-error', 'hidden');
      
      if (isError) {
        statusBox.classList.add('status-error');
      } else {
        statusBox.classList.add('status-success');
      }
      
      statusBox.style.display = 'block';
      setTimeout(() => {
        statusBox.style.display = 'none';
      }, 3000);
    }
    
    // æ ¼å¼åŒ–ä¿¡æ¯æ˜¾ç¤º
    function formatInfo(data) {
      if (typeof data === 'object') {
        let html = '';
        for (const key in data) {
          if (data.hasOwnProperty(key)) {
            html += `<div style="margin-bottom: 6px;"><span style="font-weight: 600;">${key}:</span> ${data[key]}</div>`;
          }
        }
        return html;
      }
      return data;
    }
    
    // æ›´æ–°çŠ¶æ€æ ‡ç­¾
    function updateStatus(element, status, isSuccess = true) {
      element.textContent = status;
      element.style.backgroundColor = isSuccess ? '#dcfce7' : '#fee2e2';
      element.style.color = isSuccess ? '#166534' : '#b91c1c';
    }
    
    // åœ°ç†ä½ç½®è·å–
    getLocationBtn.addEventListener('click', () => {
      if (!navigator.geolocation) {
        const error = 'æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒåœ°ç†ä½ç½®æœåŠ¡';
        locationInfo.innerHTML = error;
        updateStatus(locationStatus, 'è·å–å¤±è´¥', false);
        showStatus(error, true);
        return;
      }
      
      locationInfo.textContent = 'æ­£åœ¨è·å–ä½ç½®ä¿¡æ¯...';
      updateStatus(locationStatus, 'è·å–ä¸­');
      
      navigator.geolocation.getCurrentPosition(
        (position) => {
          const coords = position.coords;
          const locationData = {
            çº¬åº¦: coords.latitude.toFixed(6),
            ç»åº¦: coords.longitude.toFixed(6),
            ç²¾åº¦: coords.accuracy.toFixed(2) + 'ç±³',
            æµ·æ‹”: coords.altitude ? coords.altitude.toFixed(2) + 'ç±³' : 'æœªçŸ¥'
          };
          
          locationInfo.innerHTML = formatInfo(locationData);
          updateStatus(locationStatus, 'å·²è·å–');
          showStatus('ä½ç½®ä¿¡æ¯è·å–æˆåŠŸ');
        },
        (error) => {
          const errorMessages = {
            1: 'ç”¨æˆ·æ‹’ç»äº†ä½ç½®è¯·æ±‚',
            2: 'ä½ç½®è·å–å¤±è´¥',
            3: 'ä½ç½®è·å–è¶…æ—¶'
          };
          
          const errorMsg = errorMessages[error.code] || `é”™è¯¯: ${error.message}`;
          locationInfo.textContent = errorMsg;
          updateStatus(locationStatus, 'è·å–å¤±è´¥', false);
          showStatus(errorMsg, true);
        },
        {
          enableHighAccuracy: false,
          timeout: 8000,
          maximumAge: 0
        }
      );
    });
    
    // æ‘„åƒå¤´æ§åˆ¶
    startCameraBtn.addEventListener('click', async () => {
      try {
        const devices = await navigator.mediaDevices.enumerateDevices();
        const videoDevices = devices.filter(device => device.kind === 'videoinput');
        
        let constraints = {
          video: { facingMode: 'environment' },
          audio: true // éœ€è¦éŸ³é¢‘æ‰èƒ½å½•åˆ¶å¸¦å£°éŸ³çš„è§†é¢‘
        };
        
        if (videoDevices.length === 0) {
          constraints = { video: true, audio: true };
        }
        
        cameraStream = await navigator.mediaDevices.getUserMedia(constraints);
        cameraPreview.srcObject = cameraStream;
        
        // å¯ç”¨å½•åˆ¶æŒ‰é’®
        startRecordingVideoBtn.disabled = false;
        startRecordingVideoBtn.className = 'btn btn-danger';
        
        startCameraBtn.disabled = true;
        stopCameraBtn.disabled = false;
        startCameraBtn.className = 'btn btn-disabled';
        stopCameraBtn.className = 'btn btn-danger';
        updateStatus(cameraStatus, 'å·²å¼€å¯');
        showStatus('æ‘„åƒå¤´å¼€å¯æˆåŠŸ');
      } catch (error) {
        const errorMsg = `æ‘„åƒå¤´å¼€å¯å¤±è´¥: ${error.message}`;
        showStatus(errorMsg, true);
        updateStatus(cameraStatus, 'å¼€å¯å¤±è´¥', false);
      }
    });
    
    stopCameraBtn.addEventListener('click', () => {
      // åœæ­¢å½•åˆ¶ï¼ˆå¦‚æœæ­£åœ¨å½•åˆ¶ï¼‰
      if (videoRecorder && videoRecorder.state !== 'inactive') {
        stopRecordingVideoBtn.click();
      }
      
      if (cameraStream) {
        cameraStream.getTracks().forEach(track => track.stop());
        cameraPreview.srcObject = null;
        cameraStream = null;
      }
      
      // ç¦ç”¨å½•åˆ¶æŒ‰é’®
      startRecordingVideoBtn.disabled = true;
      stopRecordingVideoBtn.disabled = true;
      startRecordingVideoBtn.className = 'btn btn-disabled';
      stopRecordingVideoBtn.className = 'btn btn-disabled';
      
      startCameraBtn.disabled = false;
      stopCameraBtn.disabled = true;
      startCameraBtn.className = 'btn btn-primary';
      stopCameraBtn.className = 'btn btn-disabled';
      updateStatus(cameraStatus, 'å·²å…³é—­');
      showStatus('æ‘„åƒå¤´å·²å…³é—­');
    });
    
    // è§†é¢‘å½•åˆ¶æ§åˆ¶
    startRecordingVideoBtn.addEventListener('click', () => {
      if (!cameraStream) return;
      
      // åˆå§‹åŒ–å½•åˆ¶å™¨
      videoChunks = [];
      videoRecorder = new MediaRecorder(cameraStream, {
        mimeType: 'video/webm; codecs=vp9' // ä½¿ç”¨WebMæ ¼å¼
      });
      
      // è®°å½•å¼€å§‹æ—¶é—´
      recordingStartTime = new Date();
      
      // å¼€å§‹å½•åˆ¶
      videoRecorder.start();
      
      // æ›´æ–°UI
      startRecordingVideoBtn.disabled = true;
      stopRecordingVideoBtn.disabled = false;
      startRecordingVideoBtn.className = 'btn btn-disabled';
      stopRecordingVideoBtn.className = 'btn btn-primary';
      recordingIndicator.style.display = 'flex';
      updateStatus(cameraStatus, 'å½•åˆ¶ä¸­');
      showStatus('å¼€å§‹å½•åˆ¶è§†é¢‘');
    });
    
    stopRecordingVideoBtn.addEventListener('click', () => {
      if (!videoRecorder || videoRecorder.state === 'inactive') return;
      
      // åœæ­¢å½•åˆ¶
      videoRecorder.stop();
      
      // è®¡ç®—å½•åˆ¶æ—¶é•¿
      const recordingEndTime = new Date();
      const duration = Math.round((recordingEndTime - recordingStartTime) / 1000);
      
      // å¤„ç†å½•åˆ¶æ•°æ®
      videoRecorder.addEventListener('dataavailable', (event) => {
        videoChunks.push(event.data);
        
        // åˆ›å»ºè§†é¢‘Blob
        const videoBlob = new Blob(videoChunks, { type: 'video/webm' });
        const videoUrl = URL.createObjectURL(videoBlob);
        
        // åˆ›å»ºè§†é¢‘æ’­æ”¾å…ƒç´ 
        const recordingItem = document.createElement('div');
        recordingItem.className = 'recording-item';
        
        // è§†é¢‘ä¿¡æ¯ï¼ˆæ—¶é—´å’Œæ—¶é•¿ï¼‰
        const recordingDate = new Date().toLocaleString();
        recordingItem.innerHTML = `
          <div class="recording-info">
            <span>å½•åˆ¶äº ${recordingDate}</span>
            <span>æ—¶é•¿: ${duration}ç§’</span>
          </div>
          <video class="recorded-video" controls>
            <source src="${videoUrl}" type="video/webm">
            æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒè§†é¢‘æ’­æ”¾
          </video>
          <button class="btn btn-primary download-video" data-url="${videoUrl}" data-filename="recording-${Date.now()}.webm">
            <span>ğŸ’¾</span>ä¿å­˜è§†é¢‘
          </button>
        `;
        
        // æ·»åŠ åˆ°å½•åˆ¶åˆ—è¡¨
        recordingsList.prepend(recordingItem);
        
        // æ·»åŠ ä¸‹è½½åŠŸèƒ½
        recordingItem.querySelector('.download-video').addEventListener('click', (e) => {
          const url = e.target.closest('.download-video').dataset.url;
          const filename = e.target.closest('.download-video').dataset.filename;
          
          const a = document.createElement('a');
          a.href = url;
          a.download = filename;
          document.body.appendChild(a);
          a.click();
          document.body.removeChild(a);
        });
      });
      
      // æ›´æ–°UI
      startRecordingVideoBtn.disabled = false;
      stopRecordingVideoBtn.disabled = true;
      startRecordingVideoBtn.className = 'btn btn-danger';
      stopRecordingVideoBtn.className = 'btn btn-disabled';
      recordingIndicator.style.display = 'none';
      updateStatus(cameraStatus, 'å·²å¼€å¯');
      showStatus('è§†é¢‘å½•åˆ¶å·²å®Œæˆ');
    });
    
    // å½•éŸ³ä¸è¯­éŸ³è¯†åˆ«æ§åˆ¶
    startAudioRecordingBtn.addEventListener('click', async () => {
      try {
        if (!isRecognitionSupported) {
          showStatus('æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒè¯­éŸ³è¯†åˆ«åŠŸèƒ½', true);
          return;
        }
        
        transcriptBox.textContent = 'æ­£åœ¨è†å¬...';
        audioInfo.textContent = 'æ­£åœ¨å½•éŸ³å¹¶è¯†åˆ«...';
        
        const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
        mediaRecorder = new MediaRecorder(stream);
        audioChunks = [];
        
        mediaRecorder.addEventListener('dataavailable', event => {
          audioChunks.push(event.data);
        });
        
        mediaRecorder.addEventListener('stop', () => {
          const audioBlob = new Blob(audioChunks, { type: 'audio/wav' });
          const audioUrl = URL.createObjectURL(audioBlob);
          
          const audioElement = document.createElement('audio');
          audioElement.controls = true;
          audioElement.src = audioUrl;
          
          audioInfo.innerHTML = '<div style="margin-bottom: 8px;">å½•éŸ³å·²å®Œæˆï¼Œå¯ä»¥æ’­æ”¾ï¼š</div>';
          audioInfo.appendChild(audioElement);
        });
        
        mediaRecorder.start();
        speechRecognition.start();
        
        startAudioRecordingBtn.disabled = true;
        stopAudioRecordingBtn.disabled = false;
        startAudioRecordingBtn.className = 'btn btn-disabled';
        stopAudioRecordingBtn.className = 'btn btn-danger';
        updateStatus(audioStatus, 'å½•éŸ³ä¸­');
        showStatus('å¼€å§‹å½•éŸ³å’Œè¯­éŸ³è¯†åˆ«');
      } catch (error) {
        const errorMsg = `å½•éŸ³å¼€å¯å¤±è´¥: ${error.message}`;
        audioInfo.textContent = errorMsg;
        showStatus(errorMsg, true);
        updateStatus(audioStatus, 'å¼€å¯å¤±è´¥', false);
      }
    });
    
    stopAudioRecordingBtn.addEventListener('click', () => {
      if (mediaRecorder && mediaRecorder.state !== 'inactive') {
        mediaRecorder.stop();
        mediaRecorder.stream.getTracks().forEach(track => track.stop());
      }
      
      if (speechRecognition) {
        speechRecognition.stop();
      }
      
      startAudioRecordingBtn.disabled = false;
      stopAudioRecordingBtn.disabled = true;
      startAudioRecordingBtn.className = 'btn btn-primary';
      stopAudioRecordingBtn.className = 'btn btn-disabled';
      updateStatus(audioStatus, 'å·²åœæ­¢');
      showStatus('å½•éŸ³å’Œè¯­éŸ³è¯†åˆ«å·²åœæ­¢');
    });
    
    // é™€èºä»ªä¿¡æ¯è·å–ï¼ˆç¡®ä¿å®æ—¶åˆ·æ–°ï¼‰
    startGyroBtn.addEventListener('click', () => {
      if (!window.DeviceMotionEvent) {
        const error = 'æ‚¨çš„è®¾å¤‡ä¸æ”¯æŒé™€èºä»ª';
        gyroInfo.textContent = error;
        showStatus(error, true);
        updateStatus(gyroStatus, 'ä¸æ”¯æŒ', false);
        return;
      }
      
      gyroInfo.textContent = 'æ­£åœ¨ç›‘æµ‹é™€èºä»ªæ•°æ®...';
      
      if (DeviceMotionEvent.requestPermission) {
        DeviceMotionEvent.requestPermission()
          .then(permission => {
            if (permission === 'granted') {
              startGyroMonitoring();
            } else {
              const error = 'æœªè·å¾—é™€èºä»ªæƒé™';
              gyroInfo.textContent = error;
              showStatus(error, true);
              updateStatus(gyroStatus, 'æ— æƒé™', false);
            }
          })
          .catch(error => {
            const errorMsg = `é™€èºä»ªæƒé™è¯·æ±‚å¤±è´¥: ${error.message}`;
            gyroInfo.textContent = errorMsg;
            showStatus(errorMsg, true);
            updateStatus(gyroStatus, 'å¤±è´¥', false);
          });
      } else {
        startGyroMonitoring();
      }
    });
    
    // é™€èºä»ªå®æ—¶ç›‘æµ‹å‡½æ•°
    function startGyroMonitoring() {
      // æ¯æ¬¡è®¾å¤‡è¿åŠ¨éƒ½ä¼šè§¦å‘æ­¤å‡½æ•°ï¼Œå®ç°å®æ—¶åˆ·æ–°
      function handleMotion(event) {
        const acceleration = event.accelerationIncludingGravity;
        const rotation = event.rotationRate;
        
        const gyroData = {
          'Xè½´åŠ é€Ÿåº¦': acceleration.x.toFixed(2) + ' m/sÂ²',
          'Yè½´åŠ é€Ÿåº¦': acceleration.y.toFixed(2) + ' m/sÂ²',
          'Zè½´åŠ é€Ÿåº¦': acceleration.z.toFixed(2) + ' m/sÂ²',
          'é˜¿å°”æ³•æ—‹è½¬': rotation ? rotation.alpha.toFixed(2) + ' Â°/s' : 'ä¸æ”¯æŒ',
          'è´å¡”æ—‹è½¬': rotation ? rotation.beta.toFixed(2) + ' Â°/s' : 'ä¸æ”¯æŒ',
          'ä¼½é©¬æ—‹è½¬': rotation ? rotation.gamma.toFixed(2) + ' Â°/s' : 'ä¸æ”¯æŒ'
        };
        
        gyroInfo.innerHTML = formatInfo(gyroData);
      }
      
      // æ·»åŠ äº‹ä»¶ç›‘å¬å™¨ï¼Œè®¾å¤‡è¿åŠ¨æ—¶ä¼šæŒç»­è§¦å‘
      window.addEventListener('devicemotion', handleMotion);
      gyroHandler = handleMotion;
      
      startGyroBtn.disabled = true;
      stopGyroBtn.disabled = false;
      startGyroBtn.className = 'btn btn-disabled';
      stopGyroBtn.className = 'btn btn-danger';
      updateStatus(gyroStatus, 'ç›‘æµ‹ä¸­');
      showStatus('é™€èºä»ªç›‘æµ‹å·²å¼€å¯ï¼Œæ•°æ®å®æ—¶æ›´æ–°');
    }
    
    stopGyroBtn.addEventListener('click', () => {
      if (gyroHandler) {
        window.removeEventListener('devicemotion', gyroHandler);
        gyroHandler = null;
      }
      
      gyroInfo.textContent = 'é™€èºä»ªç›‘æµ‹å·²åœæ­¢';
      startGyroBtn.disabled = false;
      stopGyroBtn.disabled = true;
      startGyroBtn.className = 'btn btn-primary';
      stopGyroBtn.className = 'btn btn-disabled';
      updateStatus(gyroStatus, 'å·²åœæ­¢');
      showStatus('é™€èºä»ªç›‘æµ‹å·²åœæ­¢');
    });
    
    // è®¾å¤‡ä¿¡æ¯è·å–
    getDeviceInfoBtn.addEventListener('click', () => {
      try {
        const deviceData = {
          'æµè§ˆå™¨åç§°': navigator.appName,
          'æµè§ˆå™¨ç‰ˆæœ¬': navigator.appVersion,
          'ç”¨æˆ·ä»£ç†': navigator.userAgent.substring(0, 60) + '...',
          'å¹³å°': navigator.platform,
          'è¯­è¨€': navigator.language,
          'åœ¨çº¿çŠ¶æ€': navigator.onLine ? 'åœ¨çº¿' : 'ç¦»çº¿',
          'è®¾å¤‡å†…å­˜': navigator.deviceMemory ? navigator.deviceMemory + ' GB' : 'æœªçŸ¥',
          'ç¡¬ä»¶å¹¶å‘æ•°': navigator.hardwareConcurrency ? navigator.hardwareConcurrency : 'æœªçŸ¥',
          'å±å¹•åˆ†è¾¨ç‡': `${screen.width} x ${screen.height}`,
          'è§†å£å¤§å°': `${window.innerWidth} x ${window.innerHeight}`,
          'ç”µæ± çŠ¶æ€': navigator.getBattery ? 'æ”¯æŒè·å–' : 'ä¸æ”¯æŒè·å–',
          'è¯­éŸ³è¯†åˆ«æ”¯æŒ': isRecognitionSupported ? 'æ”¯æŒ' : 'ä¸æ”¯æŒ'
        };
        
        if (navigator.getBattery) {
          navigator.getBattery().then(battery => {
            deviceData['ç”µæ± çŠ¶æ€'] = battery.level * 100 + '%';
            deviceData['æ˜¯å¦å……ç”µ'] = battery.charging ? 'æ˜¯' : 'å¦';
            deviceInfo.innerHTML = formatInfo(deviceData);
          });
        } else {
          deviceInfo.innerHTML = formatInfo(deviceData);
        }
        
        updateStatus(deviceStatus, 'å·²è·å–');
        showStatus('è®¾å¤‡ä¿¡æ¯è·å–æˆåŠŸ');
      } catch (error) {
        const errorMsg = `è®¾å¤‡ä¿¡æ¯è·å–å¤±è´¥: ${error.message}`;
        deviceInfo.textContent = errorMsg;
        showStatus(errorMsg, true);
        updateStatus(deviceStatus, 'è·å–å¤±è´¥', false);
      }
    });
    
    // IPä¿¡æ¯è·å–
    getIpInfoBtn.addEventListener('click', async () => {
      try {
        ipInfo.textContent = 'æ­£åœ¨è·å–IPä¿¡æ¯...';
        
        const response = await fetch('https://ipapi.co/json/');
        if (!response.ok) {
          throw new Error('IPä¿¡æ¯è·å–å¤±è´¥');
        }
        const ipData = await response.json();
        
        const ipInfoData = {
          'IPåœ°å€': ipData.ip,
          'å›½å®¶': ipData.country_name || 'æœªçŸ¥',
          'åœ°åŒº': ipData.region || 'æœªçŸ¥',
          'åŸå¸‚': ipData.city || 'æœªçŸ¥',
          'é‚®æ”¿ç¼–ç ': ipData.postal || 'æœªçŸ¥',
          'è¿è¥å•†': ipData.org || 'æœªçŸ¥',
          'æ—¶åŒº': ipData.timezone || 'æœªçŸ¥',
          'ç»çº¬åº¦': ipData.latitude && ipData.longitude 
            ? `${ipData.latitude}, ${ipData.longitude}` 
            : 'æœªçŸ¥'
        };
        
        ipInfo.innerHTML = formatInfo(ipInfoData);
        updateStatus(ipStatus, 'å·²è·å–');
        showStatus('IPä¿¡æ¯è·å–æˆåŠŸ');
      } catch (error) {
        const errorMsg = `IPä¿¡æ¯è·å–å¤±è´¥: ${error.message}`;
        ipInfo.textContent = errorMsg;
        showStatus(errorMsg, true);
        updateStatus(ipStatus, 'è·å–å¤±è´¥', false);
      }
    });
    
    // æ·±è‰²/æµ…è‰²æ¨¡å¼åˆ‡æ¢
    const themeToggle = document.getElementById('themeToggle');
    let isDarkMode = false;
    
    themeToggle.addEventListener('click', () => {
      isDarkMode = !isDarkMode;
      document.body.classList.toggle('dark-mode', isDarkMode);
      
      if (isDarkMode) {
        themeToggle.textContent = 'â˜€ï¸';
      } else {
        themeToggle.textContent = 'ğŸŒ™';
      }
    });
    
    // é¡µé¢åŠ è½½åˆå§‹åŒ–
    window.addEventListener('load', () => {
      initSpeechRecognition();
      
      setTimeout(() => {
        getDeviceInfoBtn.click();
      }, 800);
    });
  </script>
</body>
</html>
